<!doctype html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>KameKameHUB - DBZ Characters </title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
</head>

<body style="background-color: #f5f0e6;">

    <div class="container-fluid p-3 border-bottom shadow-sm text-white" style=" background-color: #000080">
        <div class="row align-items-center">
            <div class="col-6">
                <a href="index.html" class="text-decoration-none">
                <h1 class="logo fs-4 my-0 text-start fw-bold text-white">KameKameHUB</h1>
                </a>
            </div>
            <div class="col-6 text-end d-flex justify-content-end align-items-center">
                <img src="assets/images/logo.png" alt="Dragon Ball Z" style="height:40px; width:auto;">
            </div>
        </div>
    </div>

    <div class="container mb-4 mt-5">
        <div class="row">
            <div class="col-12 text-center fw-bold">
                <div class="display-3"
                    style="color:#FF8C00; border-bottom: 3px solid #FF8C00; padding-bottom: 10px; display:inline-block;"
                    id="section-title">All Characters</div>
            </div>
        </div>

        <div class="row mt-4 justify-content-center">

            <div class="col-12 col-md-6 col-lg-4 mb-3">
                <div class="input-group">
                    <input type="text" class="form-control form-control-lg" placeholder="Search by name..."
                        id="search-input" onkeyup="updateFilteredList()">
                    <button class="btn btn-warning btn-lg" type="button"
                        onclick="document.getElementById('search-input').value = ''; updateFilteredList();">
                        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor"
                            class="bi bi-x-lg" viewBox="0 0 16 16">
                            <path
                                d="M2.146 2.854a.5.5 0 1 1 .708-.708L8 7.293l5.146-5.147a.5.5 0 0 1 .708.708L8.707 8l5.147 5.146a.5.5 0 0 1-.708.708L8 8.707l-5.146 5.147a.5.5 0 0 1-.708-.708L7.293 8z" />
                        </svg>
                    </button>
                </div>
            </div>

            <div class="col-12 text-center fw-bold d-flex flex-wrap justify-content-center align-items-center gap-3"
                id="filter-buttons-container">
            </div>
        </div>
    </div>
    <div class="container">
        <div class="row" id="contents">
            <div class="col-12 text-center" id="loading-indicator">
                <div class="spinner-border text-warning" role="status" style="width: 4rem; height: 4rem;">
                    <span class="visually-hidden">kamekameha.</span>
                </div>
                <p style="color:#FF8C00;" class="mt-2">Loading characters...</p>
            </div>
        </div>
    </div>

    <script>
        const API_URL = 'https://dragonball-api.com/api/characters?page=1&limit=100';
        let allCharacters = [];
        let currentRaceFilter = 'All'; 

        const PRIMARY_RACES = ['Saiyan', 'Human', 'Namekian', 'Frost'];

        const getRaceColor = (race) => {
            switch (race) {
                case 'Saiyan': return '#fce38a';
                case 'Human': return '#e0f7fa';
                case 'Namekian': return '#c8e6c9';
                case 'Frost': return '#bbdefb';
                default: return '#d6d3f2';
            }
        };

        var contents = document.getElementById("contents");
        var loadingIndicator = document.getElementById("loading-indicator");
        var sectionTitle = document.getElementById("section-title");
        var filterContainer = document.getElementById("filter-buttons-container");
        var searchInput = document.getElementById("search-input"); 

        const renderCharacters = (charactersToDisplay) => {
            contents.innerHTML = '';

            if (charactersToDisplay.length === 0) {
                contents.innerHTML = `<div class="col-12 text-center"><p class="h4 mt-5" style="color:#3f0071;">No characters found with the current filter and search term.</p></div>`;
                return;
            }

            charactersToDisplay.forEach(character => {
                const charName = character.name || 'Unknown';
                const charAffiliation = character.affiliation || 'None';
                const charRace = character.race || 'Unknown';
                const charImage = character.image || 'https://via.placeholder.com/200?text=No+Image';
                const charKi = character.ki || 'Unknown';

                const cardBgColor = getRaceColor(charRace);

                contents.innerHTML += `
            <div class="col-12 col-sm-6 col-md-4 col-lg-3 d-flex align-items-stretch"> 
              <div class="card my-3 shadow p-3 rounded-4 text-center w-100" style="background-color:white; border:1px solid #000080; color:#3f0071;">
                
                                <div class="mx-auto rounded-3" style="width: 100%; height: 250px; background-color:${cardBgColor}; overflow: hidden; display: flex; align-items: flex-end; justify-content: center; padding-top: 10px;">
                  <img src="${charImage}" 
                    onerror="this.src='https://via.placeholder.com/200?text=No+Image';" 
                    class="h-100" style="object-fit: contain; width: auto;"> 
                </div>
                
                                <div class="mt-3">
                                    <div class="h5 m-0" style="color:#000080; white-space: nowrap; overflow: hidden; text-overflow: ellipsis;">
                        ${charName}
                      </div>

                      <div class="small mt-1 text-muted" style="white-space: nowrap; overflow: hidden; text-overflow: ellipsis; font-weight: 600;">
                          Affiliation: ${charAffiliation}
                      </div>
                    
                                    <div class="mt-2 rounded-5 py-1 px-3 d-inline-block" style="background-color:#FF8C00; color:white; font-weight:bold; font-size:0.9rem;">
                        Ki: ${charKi}
                      </div>

                    </div>
                  </div>
                </div>
              `;
            });
        };

        const updateFilteredList = () => {
            const searchTerm = searchInput.value.toLowerCase();
            let filteredByRace;

            if (currentRaceFilter === 'All') {
                filteredByRace = allCharacters;
                sectionTitle.textContent = 'All Characters';
            } else if (currentRaceFilter === 'Other') {
                filteredByRace = allCharacters.filter(char =>
                    !PRIMARY_RACES.includes(char.race)
                );
                sectionTitle.textContent = 'Other Characters';
            } else {
                filteredByRace = allCharacters.filter(char => char.race === currentRaceFilter);
                sectionTitle.textContent = `${currentRaceFilter} Characters`;
            }

            let finalFilteredList = filteredByRace.filter(char => 
                (char.name || '').toLowerCase().includes(searchTerm)
            );

            finalFilteredList.sort((a, b) => {
                const nameA = (a.name || 'Unknown').toUpperCase();
                const nameB = (b.name || 'Unknown').toUpperCase();
                return nameA < nameB ? -1 : nameA > nameB ? 1 : 0;
            });

            renderCharacters(finalFilteredList);
        };


        const filterCharacters = (race, btn) => {
            currentRaceFilter = race; 

            document.querySelectorAll('.filter-btn').forEach(b => {
                b.style.backgroundColor = 'transparent';
                b.style.color = '#000080';
                b.style.border = '2px solid #000080';
            });

            btn.style.backgroundColor = '#FF8C00';
            btn.style.color = '#f5f0e6';
            btn.style.border = 'none';

            updateFilteredList();
        };

        const generateFilterButtons = () => {
            filterContainer.innerHTML += `
            <button class="btn btn-lg fw-bold filter-btn active" onclick="filterCharacters('All', this)" style="background-color:#FF8C00; color:#f5f0e6; border:none;">All</button>
        `;

            PRIMARY_RACES.forEach(race => {
                filterContainer.innerHTML += `
                <button class="btn btn-lg fw-bold filter-btn" onclick="filterCharacters('${race}', this)" style="background-color:transparent; color:#000080; border:2px solid #000080;">${race}</button>
            `;
            });

            filterContainer.innerHTML += `
            <button class="btn btn-lg fw-bold filter-btn" onclick="filterCharacters('Other', this)" style="background-color:transparent; color:#000080; border:2px solid #000080;">Other</button>
        `;
        };


        const initializeCharacters = async () => {
            try {
                const response = await fetch(API_URL);

                if (!response.ok) {
                    throw new Error(`HTTP error! Status: ${response.status}`);
                }

                const data = await response.json();
                allCharacters = data.items;

                loadingIndicator.style.display = 'none';
                
                searchInput = document.getElementById("search-input"); 

                generateFilterButtons();
                filterCharacters('All', document.querySelector('.filter-btn'));

            } catch (error) {
                console.error("Error fetching Dragon Ball characters:", error);
                loadingIndicator.innerHTML = `<p class="text-danger">Failed to load characters. Error: ${error.message}. Please ensure you are running this page on a local web server (e.g., Live Server).</p>`;
                loadingIndicator.style.display = 'block';
            }
        };

        initializeCharacters();
    </script>



    <div class="container-fluid py-3 text-center text-white" style="background-color: #000080;">
        <p class="mb-0">&copy; AllRightsReserved2025</p>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz"
        crossorigin="anonymous"></script>

</body>

</html>