<!doctype html>
<html lang="en">

<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>KameKameHUB</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/css/bootstrap.min.css" rel="stylesheet"
    integrity="sha384-sRIl4kxILFvY47J16cr9ZwB07vP4J8+LH7qKQnuqkuIAvNWLzeN8tE5YBujZqJLB" crossorigin="anonymous">
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700&display=swap" rel="stylesheet">
</head>

<body style="background-color:#f5f0e6; color:#3f0071; font-family: 'Poppins', sans-serif;">

  <div class="sticky-top container-fluid shadow-sm p-3 m-0" style="background-color:#000080;">
    <div class="row align-items-center py-2 px-3" style="color:#f5f0e6;">
      <div class="col-6 text-start">
        <h1 class="h3 m-0" style="color:#f5f0e6;">KameKameHUB</h1>
      </div>
      <div class="col-6 text-end d-flex justify-content-end align-items-center gap-3">
        <h1 class="h5 m-0" style="color:#f5f0e6;">Characters</h1>
        <h1 class="h5 m-0" style="color:#f5f0e6;">About API</h1>
      </div>
    </div>
  </div>

  <div class="container-fluid p-0 position-relative">
    <img src="assets/images/dbz.jpg" alt="Dragon Ball Background"
      style="width: 100%; height: 100vh; object-fit: cover;">

    <div style="position: absolute; top: 0; left: 0; width: 100%; height: 100vh;
              background: linear-gradient(to bottom, rgba(255,140,0,0.6), rgba(0,0,128,0.8));">
    </div>

    <div class="position-absolute top-50 start-50 translate-middle text-center" style="width: 100%;">
      <h1 class="display-4 display-md-2" style="color:#f5f0e6; text-shadow: 2px 2px 5px rgba(0,0,0,0.7);">
        Unleash the Power!
      </h1>
      <p style="color:#f5f0e6; text-shadow: 1px 1px 4px rgba(0,0,0,0.7); font-size:1.2rem;">
        Explore characters from the Dragon Ball Universe.
      </p>
    </div>
  </div>

  <div class="container mb-4 mt-5">
    <div class="row">
      <div class="col-12 text-center fw-bold">
        <div class="display-3"
          style="color:#FF8C00; border-bottom: 3px solid #FF8C00; padding-bottom: 10px; display:inline-block;"
          id="section-title">All Characters</div>
      </div>
    </div>
    <div class="row mt-4">
      <div class="col-12 text-center fw-bold d-flex flex-wrap justify-content-center align-items-center gap-3"
        id="filter-buttons-container">
      </div>
    </div>
  </div>

  <div class="container">
    <div class="row" id="contents">
      <div class="col-12 text-center" id="loading-indicator">
        <div class="spinner-border text-warning" role="status" style="width: 4rem; height: 4rem;">
          <span class="visually-hidden">kamekameeeeehaaa.......</span>
        </div>
        <p style="color:#FF8C00;" class="mt-2">Loading characters...</p>
      </div>
    </div>
  </div>

  <script>

    const API_URL = 'https://dragonball-api.com/api/characters?page=1&limit=100';
    let allCharacters = [];

    const PRIMARY_RACES = ['Saiyan', 'Human', 'Namekian', 'Frost'];

    const getRaceColor = (race) => {
      switch (race) {
        case 'Saiyan': return '#fce38a';
        case 'Human': return '#e0f7fa';
        case 'Namekian': return '#c8e6c9';
        case 'Frost': return '#bbdefb';
        default: return '#d6d3f2';
      }
    };

    var contents = document.getElementById("contents");
    var loadingIndicator = document.getElementById("loading-indicator");
    var sectionTitle = document.getElementById("section-title");
    var filterContainer = document.getElementById("filter-buttons-container");

    const renderCharacters = (charactersToDisplay) => {
      contents.innerHTML = '';

      if (charactersToDisplay.length === 0) {
        contents.innerHTML = `<div class="col-12 text-center"><p class="h4 mt-5" style="color:#3f0071;">No characters found in this race category.</p></div>`;
        return;
      }

      charactersToDisplay.forEach(character => {
        const charName = character.name || 'Unknown';
        const charAffiliation = character.affiliation || 'None';
        const charRace = character.race || 'Unknown';
        const charImage = character.image || 'https://via.placeholder.com/200?text=No+Image';
        const charKi = character.ki || 'Unknown';

        const cardBgColor = getRaceColor(charRace);

        contents.innerHTML += `
            <div class="col-12 col-sm-6 col-md-4 col-lg-3 d-flex align-items-stretch"> 
              <div class="card my-3 shadow p-3 rounded-4 text-center w-100" style="background-color:white; border:1px solid #000080; color:#3f0071;">
                
                                <div class="mx-auto rounded-3" style="width: 100%; height: 250px; background-color:${cardBgColor}; overflow: hidden; display: flex; align-items: flex-end; justify-content: center; padding-top: 10px;">
                  <img src="${charImage}" 
                   onerror="this.src='https://via.placeholder.com/200?text=No+Image';" 
                    class="h-100" style="object-fit: contain; width: auto;"> 
                </div>
                
                                <div class="mt-3">
                                    <div class="h5 m-0" style="color:#000080; white-space: nowrap; overflow: hidden; text-overflow: ellipsis;">
                    ${charName}
                  </div>

                    <div class="small mt-1 text-muted" style="white-space: nowrap; overflow: hidden; text-overflow: ellipsis; font-weight: 600;">
                        Affiliation: ${charAffiliation}
                    </div>
                  
                                    <div class="mt-2 rounded-5 py-1 px-3 d-inline-block" style="background-color:#FF8C00; color:white; font-weight:bold; font-size:0.9rem;">
                    Ki: ${charKi}
                  </div>

                </div>
              </div>
            </div>
          `;
      });
    };

    const filterCharacters = (race, btn) => {

      document.querySelectorAll('.filter-btn').forEach(b => {
        b.style.backgroundColor = 'transparent';
        b.style.color = '#000080';
        b.style.border = '2px solid #000080';
      });

        btn.style.backgroundColor = '#FF8C00';
        btn.style.color = '#f5f0e6';
        btn.style.border = 'none';

      let filteredList;
      if (race === 'All') {
        filteredList = allCharacters;
        sectionTitle.textContent = 'All Characters';
      } else if (race === 'Other') {
        filteredList = allCharacters.filter(char =>
          !PRIMARY_RACES.includes(char.race)
        );
        sectionTitle.textContent = 'Other Characters';
      } else {
        filteredList = allCharacters.filter(char => char.race === race);
        sectionTitle.textContent = `${race} Characters`;
      }

      filteredList.sort((a, b) => {
            const nameA = (a.name || 'Unknown').toUpperCase(); 
            const nameB = (b.name || 'Unknown').toUpperCase();

            if (nameA < nameB) {
                return -1;
            }
            if (nameA > nameB) {
                return 1;
            }
            return 0; 
        });

      renderCharacters(filteredList);
    };

    const generateFilterButtons = () => {
      filterContainer.innerHTML += `
            <button class="btn btn-lg fw-bold filter-btn active" onclick="filterCharacters('All', this)" style="background-color:#FF8C00; color:#f5f0e6; border:none;">All</button>
        `;

      PRIMARY_RACES.forEach(race => {
        filterContainer.innerHTML += `
                <button class="btn btn-lg fw-bold filter-btn" onclick="filterCharacters('${race}', this)" style="background-color:transparent; color:#000080; border:2px solid #000080;">${race}</button>
            `;
      });

      filterContainer.innerHTML += `
            <button class="btn btn-lg fw-bold filter-btn" onclick="filterCharacters('Other', this)" style="background-color:transparent; color:#000080; border:2px solid #000080;">Other</button>
        `;
    };


    const initializeCharacters = async () => {
      try {
        const response = await fetch(API_URL);

        if (!response.ok) {
          throw new Error(`HTTP error! Status: ${response.status}`);
        }

        const data = await response.json();
        allCharacters = data.items;

        loadingIndicator.style.display = 'none';

        generateFilterButtons();
        filterCharacters('All', document.querySelector('.filter-btn'));

      } catch (error) {
        console.error("Error fetching Dragon Ball characters:", error);
        loadingIndicator.innerHTML = `<p class="text-danger">Failed to load characters. Error: ${error.message}. Please ensure you are running this page on a local web server (e.g., Live Server).</p>`;
        loadingIndicator.style.display = 'block';
      }
    };

    initializeCharacters();
  </script>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/js/bootstrap.bundle.min.js"
    integrity="sha384-FKyoEForCGlyvwx9Hj09JcYn3nv7wiPVlz7YYwJrWVcXK/BmnVDxM+D2scQbITxI"
    crossorigin="anonymous"></script>
</body>

</html>